var md5=new function(){
  var l='length',
  h=[
   '0123456789abcdef',0x0F,0x80,0xFFFF,
    0x67452301,0xEFCDAB89,0x98BADCFE,0x10325476
  ],
  x=[
    [0,1,[7,12,17,22]],
    [1,5,[5, 9,14,20]],
    [5,3,[4,11,16,23]],
    [0,7,[6,10,15,21]]
  ],
  A=function(x,y,z){
    return(((x>>16)+(y>>16)+((z=(x&h[3])+(y&h[3]))>>16))<<16)|(z&h[3])
  },
  B=function(s){
    var n=((s[l]+8)>>6)+1,b=new Array(1+n*16).join('0').split('');
    for(var i=0;i<s[l];i++)b[i>>2]|=s.charCodeAt(i)<<((i%4)*8);
    return(b[i>>2]|=h[2]<<((i%4)*8),b[n*16-2]=s[l]*8,b)
  },
  R=function(n,c){return(n<<c)|(n>>>(32-c))},
  C=function(q,a,b,x,s,t){return A(R(A(A(a,q),A(x,t)),s),b)},
  F=function(a,b,c,d,x,s,t){return C((b&c)|((~b)&d),a,b,x,s,t)},
  G=function(a,b,c,d,x,s,t){return C((b&d)|(c&(~d)),a,b,x,s,t)},
  H=function(a,b,c,d,x,s,t){return C(b^c^d,a,b,x,s,t)},
  I=function(a,b,c,d,x,s,t){return C(c^(b|(~d)),a,b,x,s,t)},
  _=[F,G,H,I],
  S=(function(){
    with(Math)for(var i=0,a=[],x=pow(2,32);i<64;a[i]=floor(abs(sin(++i))*x));
    return a
  })(),
  X=function (n){
    for(var j=0,s='';j<4;j++)
      s+=h[0].charAt((n>>(j*8+4))&h[1])+h[0].charAt((n>>(j*8))&h[1]);
    return s
  };
  return function(s){
    var $=B(''+s),a=[0,1,2,3],b=[0,3,2,1],v=[h[4],h[5],h[6],h[7]];
    for(var i,j,k,N=0,J=0,o=[].concat(v);N<$[l];N+=16,o=[].concat(v),J=0){
      for(i=0;i<4;i++)
        for(j=0;j<4;j++)
          for(k=0;k<4;k++,a.unshift(a.pop()))
            v[b[k]]=_[i](
              v[a[0]],
              v[a[1]],
              v[a[2]],
              v[a[3]],
              $[N+(((j*4+k)*x[i][1]+x[i][0])%16)],
              x[i][2][k],
              S[J++]
            );
      for(i=0;i<4;i++)
        v[i]=A(v[i],o[i]);
    };return X(v[0])+X(v[1])+X(v[2])+X(v[3]);
}};

// Yandex URL for products
$(document).ready(function(){
    var url = window.location.href;
    if (url.indexOf('?id-') + 1) {
        var spl = url.split('?id-');
        id = spl[1];
        modal_id = '#more-' + id;
        $(modal_id).modal('show');
    }
});

// Image Lazy Load
/*
$(document).ready(function(){

	$('.panel-body img[src]').each(function(){
		$(this).attr('data-src', $(this).attr('src'));
		$(this).removeAttr('src');
	});

	$('.modal').on('shown.bs.modal', function(){
		$(this).find('[data-src]').each(function(){
			var src = $(this).attr('data-src');
			$(this).attr('src', src);
			$(this).removeAttr('src');
		});

	});
              
    var Visible = function (target) {
      var targetPosition = {
          top: window.pageYOffset + target[0].getBoundingClientRect().top,
          left: window.pageXOffset + target[0].getBoundingClientRect().left,
          right: window.pageXOffset + target[0].getBoundingClientRect().right,
          bottom: window.pageYOffset + target[0].getBoundingClientRect().bottom
        },

        windowPosition = {
          top: window.pageYOffset,
          left: window.pageXOffset,
          right: window.pageXOffset + document.documentElement.clientWidth,
          bottom: window.pageYOffset + document.documentElement.clientHeight
        };

      if (targetPosition.bottom > windowPosition.top && 
        targetPosition.top < windowPosition.bottom && 
        targetPosition.right > windowPosition.left && 
        targetPosition.left < windowPosition.right) { 
            if(target[0].hasAttribute('data-src')){
                var src = target[0].getAttribute('data-src');
                target[0].setAttribute('src', src);
				target[0].removeAttribute('data-src');
            }
            if(target[0].hasAttribute('data-style')){
                var style = target[0].getAttribute('data-style');
                target[0].setAttribute('style', style);
				target[0].removeAttribute('data-style');
            }
      };
    };

    window.addEventListener('scroll', function() {
        $('[data-src], [data-style]').each(function(){
            Visible($(this));
        });
    });

	$('.left, .right').on('click', function(){
		$('[data-src], [data-style]').each(function(){
            Visible($(this));
        });
	});

    $('[data-src], [data-style]').each(function(){
        Visible($(this));
    });
});
*/

// Old script minimized
function img_postload(t,e,o,n){function a(){for(i=0;i<r.length;i++)$(document).scrollTop()+$(window).height()>$(r.eq(i)).offset().top&&$(document).scrollTop()-$(r.eq(i)).offset().top<$(r.eq(i)).height()&&s(r.eq(i))}function s(t){var t=t;null!=t.attr("data-src")&&(t.attr("src",t.attr("data-src")),t.on("load",function(){t.attr("data-src",null),t.attr("style",null)}).each(function(){this.complete&&$(this).load()}))}var t=t,e=e,o=o,n=n,r=$(t);if(null!=n)for(i=0;i<r.length;i++)r.eq(i).attr("style","background: url("+n+");background-position: center center;background-repeat: no-repeat;"),r.eq(i).attr("data-src",r.eq(i).attr("src")),r.eq(i).attr("src",null);$(window).on("load scroll",function(){a()}),$(e).on("click",function(){setTimeout(function(){var e=$(o+" "+t);for(i=0;i<e.length;i++)s(e.eq(i))},400)})}function setEqualHeight(t){var e=0;t.each(function(){currentHeight=$(this).height(),currentHeight>e&&(e=currentHeight)}),t.height(e)}function init(){myMap=new ymaps.Map("ya_map",{center:[54.9632,35.4447],zoom:4}),myMap.controls.add(new ymaps.control.SmallZoomControl,{right:"10px",top:"50px"}),searchControl=new ymaps.control.SearchControl({provider:"yandex#map",noPlacemark:"true",kind:"locality"}),myMap.controls.add(searchControl,{right:"200px",top:"10px"}),createBallon()}function createBallon(){var t=[];$(".item").each(function(){var e=$(this).attr("data-id"),o=$(this).attr("data-active"),i=0;i=$(this).find("a").hasClass("click")?1:0,t[e]={cord:[parseFloat($(this).find("a").attr("data-lat")),parseFloat($(this).find("a").attr("data-lon"))],zoom:"",click:i,id:e,header:$(this).find(".name").text(),content:$(this).find(".adress").html(),active:o}});var e=[];t.forEach(function(t,o,i){var n={balloonContentHeader:t.header,balloonContentBody:t.content},a=1!=t.active?"#e8744b":"#1e98ff";1==t.active&&(n=""),e[t.id]=new ymaps.GeoObject({geometry:{type:"Point",coordinates:t.cord},properties:n},{iconColor:a}),e[t.id].events.add("click",function(){myMap.setCenter(t.cord),myMap.setZoom(9)}),myMap.geoObjects.add(e[t.id]),1==t.click&&1!=t.active&&e[t.id].balloon.open()})}

// Calc price for complect
function calc_complect(){
    var new_price_left = Number($('#leftCarousel').find('.carousel-inner .active').attr('data-price'));
    var new_price_right = Number($('#rightCarousel').find('.carousel-inner .active').attr('data-price'));
		$('#new-price').html(new_price_left+new_price_right);
		var share_size = parseInt($('#share-size').html());
		var share_price = parseInt(new_price_left+new_price_right-((new_price_left+new_price_right)*share_size/100));
		$('#share-price').html(share_price);
}!function(t){"use strict";function e(){var e=r.clientHeight,o=t.innerHeight;return o>e?o:e}function o(){return t.pageYOffset||r.scrollTop}function i(t){var e=0,o=0;do isNaN(t.offsetTop)||(e+=t.offsetTop),isNaN(t.offsetLeft)||(o+=t.offsetLeft);while(t=t.offsetParent);return{top:e,left:o}}function n(t,n){var a=t.offsetHeight,s=o(),r=s+e(),c=i(t).top,l=c+a,n=n||0;return r>=c+a*n&&l>=s}function a(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function s(t,e){this.el=t,this.options=a(this.defaults,e),this._init()}var r=t.document.documentElement;s.prototype={defaults:{viewportFactor:.2},_init:function(){this.sections=Array.prototype.slice.call(this.el.querySelectorAll(".cbp-so-section")),this.didScroll=!1;var e=this;this.sections.forEach(function(t,e){n(t)||classie.add(t,"cbp-so-init")});var o=function(){e.didScroll||(e.didScroll=!0,setTimeout(function(){e._scrollPage()},60))},i=function(){function t(){e._scrollPage(),e.resizeTimeout=null}e.resizeTimeout&&clearTimeout(e.resizeTimeout),e.resizeTimeout=setTimeout(t,200)};t.addEventListener("scroll",o,!1),t.addEventListener("resize",i,!1)},_scrollPage:function(){var t=this;this.sections.forEach(function(e,o){n(e,t.options.viewportFactor)?classie.add(e,"cbp-so-animate"):(classie.add(e,"cbp-so-init"),classie.remove(e,"cbp-so-animate"))}),this.didScroll=!1}},t.cbpScroller=s}(window),function(t){t.fn.loupe=function(e){var o=t.extend({loupe:"loupe",width:600,height:500},e||{});return this.length?this.each(function(){var i,n,a,s,r=t(this),c=r.is("img")?r:r.find("img:first"),l=function(){n.hide()};return null!=r.data("loupe")?r.data("loupe",e):(a=function(t){var e=c.offset(),a=c.outerWidth(),u=c.outerHeight(),d=o.width/2,h=o.height/2;return!r.data("loupe")||t.pageX>a+e.left+10||t.pageX<e.left-10||t.pageY>u+e.top+10||t.pageY<e.top-10?l():(s=s?clearTimeout(s):0,n.show().css({left:t.pageX-d,top:t.pageY-h}),void i.css({left:0|-((t.pageX-e.left)/a*i.width()-d),top:0|-((t.pageY-e.top)/u*i.height()-h)}))},n=t("<div />").addClass(o.loupe).css({width:o.width,height:o.height,position:"absolute",overflow:"hidden"}).append(i=t("<img />").attr("src",r.attr(r.is("img")?"src":"href")).css("position","absolute")).mousemove(a).hide().appendTo("body"),void r.data("loupe",!0).mouseenter(a).mouseout(function(){s=setTimeout(l,10)}))}):this}}(jQuery),!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";function e(t){if(t instanceof Date)return t;if(String(t).match(s))return String(t).match(/^[0-9]*$/)&&(t=Number(t)),String(t).match(/\-/)&&(t=String(t).replace(/\-/g,"/")),new Date(t);throw new Error("Couldn't cast `"+t+"` to a date object.")}function o(t){var e=t.toString().replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");return new RegExp(e)}function i(t){return function(e){var i=e.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi);if(i)for(var a=0,s=i.length;s>a;++a){var r=i[a].match(/%(-|!)?([a-zA-Z]{1})(:[^;]+;)?/),l=o(r[0]),u=r[1]||"",d=r[3]||"",h=null;r=r[2],c.hasOwnProperty(r)&&(h=c[r],h=Number(t[h])),null!==h&&("!"===u&&(h=n(d,h)),""===u&&10>h&&(h="0"+h.toString()),e=e.replace(l,h.toString()))}return e=e.replace(/%%/,"%")}}function n(t,e){var o="s",i="";return t&&(t=t.replace(/(:|;|\s)/gi,"").split(/\,/),1===t.length?o=t[0]:(i=t[0],o=t[1])),Math.abs(e)>1?o:i}var a=[],s=[],r={precision:100,elapse:!1,defer:!1};s.push(/^[0-9]*$/.source),s.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source),s.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source),s=new RegExp(s.join("|"));var c={Y:"years",m:"months",n:"daysToMonth",d:"daysToWeek",w:"weeks",W:"weeksToMonth",H:"hours",M:"minutes",S:"seconds",D:"totalDays",I:"totalHours",N:"totalMinutes",T:"totalSeconds"},l=function(e,o,i){this.el=e,this.$el=t(e),this.interval=null,this.offset={},this.options=t.extend({},r),this.instanceNumber=a.length,a.push(this),this.$el.data("countdown-instance",this.instanceNumber),i&&("function"==typeof i?(this.$el.on("update.countdown",i),this.$el.on("stoped.countdown",i),this.$el.on("finish.countdown",i)):this.options=t.extend({},r,i)),this.setFinalDate(o),this.options.defer===!1&&this.start()};t.extend(l.prototype,{start:function(){null!==this.interval&&clearInterval(this.interval);var t=this;this.update(),this.interval=setInterval(function(){t.update.call(t)},this.options.precision)},stop:function(){clearInterval(this.interval),this.interval=null,this.dispatchEvent("stoped")},toggle:function(){this.interval?this.stop():this.start()},pause:function(){this.stop()},resume:function(){this.start()},remove:function(){this.stop.call(this),a[this.instanceNumber]=null,delete this.$el.data().countdownInstance},setFinalDate:function(t){this.finalDate=e(t)},update:function(){if(0===this.$el.closest("html").length)return void this.remove();var e,o=void 0!==t._data(this.el,"events"),i=new Date;e=this.finalDate.getTime()-i.getTime(),e=Math.ceil(e/1e3),e=!this.options.elapse&&0>e?0:Math.abs(e),this.totalSecsLeft!==e&&o&&(this.totalSecsLeft=e,this.elapsed=i>=this.finalDate,this.offset={seconds:this.totalSecsLeft%60,minutes:Math.floor(this.totalSecsLeft/60)%60,hours:Math.floor(this.totalSecsLeft/60/60)%24,days:Math.floor(this.totalSecsLeft/60/60/24),daysToWeek:Math.floor(this.totalSecsLeft/60/60/24),daysToMonth:Math.floor(this.totalSecsLeft/60/60/24%30.4368),weeks:Math.floor(this.totalSecsLeft/60/60/24/7),weeksToMonth:Math.floor(this.totalSecsLeft/60/60/24/7)%4,months:Math.floor(this.totalSecsLeft/60/60/24/30.4368),years:Math.abs(this.finalDate.getFullYear()-i.getFullYear()),totalDays:Math.floor(this.totalSecsLeft/60/60/24),totalHours:Math.floor(this.totalSecsLeft/60/60),totalMinutes:Math.floor(this.totalSecsLeft/60),totalSeconds:this.totalSecsLeft},this.options.elapse||0!==this.totalSecsLeft?this.dispatchEvent("update"):(this.stop(),this.dispatchEvent("finish")))},dispatchEvent:function(e){var o=t.Event(e+".countdown");o.finalDate=this.finalDate,o.elapsed=this.elapsed,o.offset=t.extend({},this.offset),o.strftime=i(this.offset),this.$el.trigger(o)}}),t.fn.countdown=function(){var e=Array.prototype.slice.call(arguments,0);return this.each(function(){var o=t(this).data("countdown-instance");if(void 0!==o){var i=a[o],n=e[0];l.prototype.hasOwnProperty(n)?i[n].apply(i,e.slice(1)):null===String(n).match(/^[$A-Z_][0-9A-Z_$]*$/i)?(i.setFinalDate.call(i,n),i.start()):t.error("Method %s does not exist on jQuery.countdown".replace(/\%s/gi,n))}else new l(this,e[0],e[1])})}}),$(document).ready(function(){img_postload(selector=".delay-img",modal_open='[data-toggle="modal"]',modal_active=".modal.in",preloader=""),$('[data-toggle="modal"]').on("click",function(){setTimeout(function(){$(".modal.in .louping").loupe()},410)})});var vid=document.getElementById("bgvid"),pauseButton=document.getElementById("video-block"),images_src="/assets/fornelli/images/icons/";pauseButton.addEventListener("click",function(){vid.classList.toggle("stopfade"),vid.paused?(vid.play(),$(".video-off").toggleClass("active"),$(".video-present").toggleClass("active"),$("#play").toggleClass("active-btn"),$(".video-play img").attr("src",images_src+"pause.svg"),$(".video").toggleClass("playing")):(vid.pause(),$(".video-off").toggleClass("active"),$(".video-present").toggleClass("active"),$("#play").toggleClass("active-btn"),$(".video-play img").attr("src",images_src+"play.svg"),$(".video").toggleClass("playing"))}),$(window).on("scroll resize",function(){if($(window).width()>769){var t=0;$(".products .col-sm-3 .product").each(function(){currentHeight=$(this).height(),currentHeight>t&&(t=currentHeight)}),$(".products .assort .product").height(t)}}),$(document).ready(function(){$(window).scroll(function(){0!=$(this).scrollTop()?$("nav").addClass("scrolled"):$("nav").removeClass("scrolled")})}),$(document).ready(function(){setEqualHeight($(".reasons .content div>div"))}),$(document).ready(function(){$(".back-top-link").hide(),$(function(){$(window).scroll(function(){$(this).scrollTop()>100?$(".back-top-link").fadeIn():$(".back-top-link").fadeOut()}),$(".back-top-link").click(function(){return $("body,html").animate({scrollTop:0},800),!1})})}),new cbpScroller(document.getElementById("cbp-so-scroller")),$(document).ready(function(){$(".navigation-menu").on("click","a",function(t){t.preventDefault();var e=$(this).attr("href"),o=$(e).offset().top-40;$("body,html").animate({scrollTop:o},500)})}),$(document).ready(function(){$(".assort").on("click","a",function(t){t.preventDefault();var e=$(this).attr("href"),o=$(e).offset().top-40;$("body,html").animate({scrollTop:o},500)})}),$(window).ready(function(){function t(t){var t=t,e=100/$(t+" .carousel-indicators li").length-.1;$(t+" .carousel-indicators li").css("width",e+"%")}function e(t){var t=t,e=100/$(t+" .carousel-indicators li").length;$(t+" .carousel-indicators li").css("height",e+"%")}t("#carousel-id"),t("#carousel-reviews"),e("#leftCarousel"),e("#rightCarousel")});var myMap;$(document).ready(function(){$(".chose_city").click(function(t){t.preventDefault();var e=$.trim($(this).text());$(".select_city").val(e).change(),$(".popup").hide(),$(".popup__overlay").hide()}),p=$(".popup__overlay"),$("#popup__toggle").click(function(){p.css("display","block"),$(".popup").show()}),p.click(function(t){e=t||window.event,e.target==this&&$(p).css("display","none")}),$(".close").click(function(t){t.preventDefault(),p.css("display","none"),$(".popup").hide()}),ymaps.ready(function(){init()}),$(".item a").on("click",function(t){t.preventDefault(),$(".item a").removeClass("click"),$(this).addClass("click");var e=[parseFloat($(this).attr("data-lat")),parseFloat($(this).attr("data-lon"))];ymaps.load(function(){myMap.setCenter(e),myMap.setZoom(13),createBallon()}),$("html, body").animate({scrollTop:$("#popup__toggle").offset().top-30},"slow")}),$(".select_city").on("change",function(){$(".item_wrap").show(),$(".item a").removeClass("click");var t,e=$.trim($(this).find("option:selected").text()),o="allcity"==$(this).find("option:selected").val(),i=[parseFloat(58.9632),parseFloat(65.4447)];$(".item").each(function(){$(this).attr("data-city")!=e?$(this).hide().removeClass("show"):(t=[parseFloat($(this).find("a").attr("data-lat")),parseFloat($(this).find("a").attr("data-lon"))],$(this).show().addClass("show"))}),o?($(".item").show().addClass("show"),myMap.setCenter(i),myMap.setZoom(2)):(myMap.setCenter(t),myMap.setZoom(8))})}),$(document).ready(function(){$(".cback").hide(),$(function(){$(window).scroll(function(){$(this).scrollTop()>100?$(".cback").fadeIn():$(".cback").fadeOut()})})}),$(".cback>a").on("click",function(){$(".cback").toggleClass("active")}),$("#phone").mask("+7(999) 999-99-99"),$("#phone2").mask("+7(999) 999-99-99"),$(document).ready(function(){calc_complect()}),$("#leftCarousel").on("slid.bs.carousel",function(){calc_complect()}),$("#rightCarousel").on("slid.bs.carousel",function(){calc_complect()});

// Read more btn for seo texts
$(document).ready(function(){
  $('.seo-text-block').readmore({
      collapsedHeight: 205,
      heightMargin: 16,
      lessLink: '<a href="#" class="readmorebtn lato-bold">Свернуть текст</a>',
      moreLink: '<a href="#" class="readmorebtn lato-bold">Подробнее</a>'
  });
});

// Spaces in product prices
function spaces (mas){
    var mas = mas;

    for (var i=0;i<mas.length;i++){
        var str = mas.eq(i).html();
        mas.eq(i).html(str.substring(0,str.length - 3) + ' ' + str.slice(-3));
    }
}

$(document).on('ready',function(){
    spaces($('.product .new-price b'));
    spaces($('.product .old-price s'));
    spaces($('#new-price'));
    spaces($('#old-price'));
    spaces($('#share-price'));
    spaces($('.modal .more-info .price span'));
    $("#buy-all").on('shown.bs.modal',function(){spaces($('#price_comlecte'));});
    $("#leftCarousel").on("slid.bs.carousel",function(){spaces($('#new-price'));spaces($('#share-price'));});
    $("#rightCarousel").on("slid.bs.carousel",function(){spaces($('#new-price'));spaces($('#share-price'));});
    $("#centCarousel").on("slid.bs.carousel",function(){spaces($('#new-price'));spaces($('#share-price'));});
});

// Share Date Generate
var share_date = localStorage.getItem('share_date'),
today = new Date(),
tomorrow = new Date(today.getTime() + (16 * 60 * 59 * 1000));

if(share_date == null) {    
    // формат 2018/10/01 12:00:00
    share_date = tomorrow;
    localStorage.setItem('share_date', share_date);
}

today_p = Date.parse(today);
share_date_p = Date.parse(share_date);

if(today_p > share_date_p) {
    share_date = tomorrow;
    localStorage.setItem('share_date', share_date);
} else {
    share_date = new Date(share_date);
}

share_date = share_date.getFullYear() + '/' + (share_date.getMonth()+1) + '/' + share_date.getDate() + ' ' + share_date.getHours() + ':' + share_date.getMinutes() + ':' + share_date.getSeconds();

// Init timer
 $(window).on('load', function() {
   var labels = ['ДНЕЙ', 'ЧАСОВ', 'МИНУТ', 'СЕКУНД'],     
     endDate = share_date,
     timer = _.template($('#main-countdown-timer').html()),
     currDate = '00:00:00:00:00',
     nextDate = '00:00:00:00:00',
     parser = /([0-9]{2})/gi,
     $countdown = $('#main-countdown');
   // Parse countdown string to an object
   function strfobj(str) {
     var parsed = str.match(parser),
       obj = {};
     labels.forEach(function(label, i) {
       obj[label] = parsed[i]
     });
     return obj;
   }
   // Return the time components that diffs
   function diff(obj1, obj2) {
     var diff = [];
     labels.forEach(function(key) {
       if (obj1[key] !== obj2[key]) {
         diff.push(key);
       }
     });
     return diff;
   }
   // Build the layout
   var initData = strfobj(currDate);
   labels.forEach(function(label, i) {
     $countdown.append(timer({
       curr: initData[label],
       next: initData[label],
       label: label
     }));
   });
   // Starts the countdown
   $countdown.countdown(endDate, function(event) {
     var newDate = event.strftime('%d:%H:%M:%S'),
       data;
     if (newDate !== nextDate) {
       currDate = nextDate;
       nextDate = newDate;
       // Setup the data
       data = {
         'curr': strfobj(currDate),
         'next': strfobj(nextDate)
       };
       // Apply the new values to each node that changed
       diff(data.curr, data.next).forEach(function(label) {
         var selector = '.%s'.replace(/%s/, label),
             $node = $countdown.find(selector);
         // Update the node
         $node.removeClass('flip');
         $node.find('.curr').text(data.curr[label]);
         $node.find('.next').text(data.next[label]);
         // Wait for a repaint to then flip
         _.delay(function($node) {
           $node.addClass('flip');
         }, 50, $node);
       });
     }
   });
 });

// Menu Items Scrolling
$(window).on('scroll resize',function(){
    pick = $("#pick").offset().top;
    technology = $("#technology").offset().top;
    products = $("#products").offset().top;
    comments = $("#comments").offset().top;
    s_top = $(window).scrollTop()+50;


    if(s_top > pick){
        $('.menu__list .menu__item').removeClass('menu__item--current');
        $('.menu__list .menu__item').eq(0).addClass('menu__item--current');
    }
    if(s_top > technology){
        $('.menu__list .menu__item').removeClass('menu__item--current');
        $('.menu__list .menu__item').eq(1).addClass('menu__item--current');
    }
    if(s_top > products){
        $('.menu__list .menu__item').removeClass('menu__item--current');
        $('.menu__list .menu__item').eq(2).addClass('menu__item--current');
    }
    if(s_top > comments){
        $('.menu__list .menu__item').removeClass('menu__item--current');
        $('.menu__list .menu__item').eq(3).addClass('menu__item--current');
    }
});

// Buy and send Ajax
$( "#button-buy-complect" ).on('click', function() {
  var id_left_product = $("#leftCarousel .active.item").attr('data-id-product'),
	  id_right_product = $("#rightCarousel .active.item").attr('data-id-product'),
	  id_cent_product = $("#centCarousel .active.item").attr('data-id-product'),
	  id_left_price = parseInt($("#leftCarousel .active.item").attr('data-price')),
	  id_right_price = parseInt($("#rightCarousel .active.item").attr('data-price')),
	  id_cent_price = parseInt($("#centCarousel .active.item").attr('data-price')),
	  price_complecte = id_left_price+id_right_price,//+id_cent_price,
	  share_price_complecte = id_left_price+id_right_price,
	  html_one_element=$("div[data-id-buy-modal="+id_left_product+"]").html(),
	  html_two_element=$("div[data-id-buy-modal="+id_right_product+"]").html(),
	  html_three_element=$("div[data-id-buy-modal="+id_cent_product+"]").html();

  $("#one_item_complecte").html(html_one_element);
  $("#two_item_complecte").html(html_two_element);
  $("#three_item_complecte").html(html_three_element);
  $("#price_comlecte").text(price_complecte.toFixed(0));
  $("#share_price_comlecte").text(share_price_complecte);
  
  $('body').find('#one_item_complecte').find('#price-one-'+id_left_product)[0].attributes[1].value = id_left_price;
  $('body').find('#one_item_complecte').find('#price-one-'+id_left_product)[0].innerHTML = abc2(id_left_price);
  
  $('body').find('#two_item_complecte').find('#price-one-'+id_right_product)[0].attributes[1].value = id_right_price;
  $('body').find('#two_item_complecte').find('#price-one-'+id_right_product)[0].innerHTML = abc2(id_right_price);
});

$( "#button_all_modal" ).on('click', function() {
  var id_left_product = $("#leftCarousel .active.item").attr('data-id-product'),
  		id_right_product = $("#rightCarousel .active.item").attr('data-id-product'),
		id_cent_product = $("#centCarousel .active.item").attr('data-id-product'),
		price_left_product = $("#leftCarousel .active.item").attr('data-price'),
		price_right_product = $("#rightCarousel .active.item").attr('data-price'),
		price_cent_product = $("#centCarousel .active.item").attr('data-price'),
		share_size = parseInt($('#share-size').html());

  if ($('#share-size').html()){
        var share_size = parseInt($('#share-size').html());
  }else{
        var share_size = 0;
  }

  price_left_product = String(parseInt(price_left_product-(price_left_product*share_size/100)));
  price_right_product = String(parseInt(price_right_product-(price_right_product*share_size/100)));
  price_cent_product = String(parseInt(price_cent_product-(price_cent_product*share_size/100)));

  var str_price_left_product = price_left_product.substring(0,price_left_product.length - 3) + ' ' + price_left_product.slice(-3),
	  str_price_right_product = price_right_product.substring(0,price_right_product.length - 3) + ' ' + price_right_product.slice(-3),
	  str_price_cent_product = 0;//price_cent_product.substring(0,price_cent_product.length - 3) + ' ' + price_cent_product.slice(-3),
	  title_left_product = $("#one_item_complecte .title-1").text()+' '+$("#one_item_complecte .title-2").text(),
	  title_right_product = $("#two_item_complecte .title-1").text()+' '+$("#two_item_complecte .title-2").text(),
	  title_cent_product = $("#three_item_complecte .title-1").text()+' '+$("#three_item_complecte .title-2").text(),
	  img_left_product = $("#one_item_complecte img").attr('src'),
	  img_right_product = $("#two_item_complecte img").attr('src'),
	  img_cent_product = $("#three_item_complecte img").attr('src');

  $("#basket__body").append('<tr id="basket_item-'+id_left_product+'" data-id="'+id_left_product+'" class="basket_item" data-price="'+price_left_product+'"><td width="25%"><img alt="product" class="img-responsive" src="'+location.protocol+'//'+location.hostname+'/'+img_left_product+'"></td><td width="50%">'+title_left_product+'</td><td width="20%"><span class="font-bold product-price">'+str_price_left_product+'</span> <span class="fa fa-ruble"></span><br><span class="red hidden">(-'+share_size+'%)</span></td><td width="5%"><a type="button" class="close" onclick="$(this).parent().parent().remove();">&times;</a></td></tr><tr id="basket_item-'+id_right_product+'" data-id="'+id_right_product+'" class="basket_item" data-price="'+price_right_product+'"><td width="25%"><img alt="product" class="img-responsive" src="'+location.protocol+'//'+location.hostname+'/'+img_right_product+'"></td><td width="50%">'+title_right_product+'</td><td width="20%"><span class="font-bold product-price">'+str_price_right_product+'</span> <span class="fa fa-ruble"></span><br><span class="red hidden">(-'+share_size+'%)</span></td><td width="5%"><a type="button" class="close" onclick="$(this).parent().parent().remove();">&times;</a></td></tr><tr id="basket_item-'+id_cent_product+'" data-id="'+id_cent_product+'" class="basket_item" data-price="'+price_cent_product+'"><td width="25%"><img alt="product" class="img-responsive" src="'+location.protocol+'//'+location.hostname+'/'+img_cent_product+'"></td><td width="50%">'+title_cent_product+'</td><td width="20%"><span class="font-bold product-price">'+str_price_cent_product+'</span> <span class="fa fa-ruble"></span><br><span class="red hidden">(-'+share_size+'%)</span></td><td width="5%"><a type="button" class="close" onclick="$(this).parent().parent().remove();">&times;</a></td></tr>');
});

$(".modal").on('click', '.button_one_product', function() {
//$(".button_one_product").on('click', function() {
    var product_id = $(this).attr('data-id-product-one'),
	  product_title = $("#buy-"+product_id).attr('data-title'),
	  price_product = $('#price-one-'+product_id).attr('data-price'),
	  img_product = $("#img-one-"+product_id).attr('src'),
	  str_price_product = price_product.substring(0,price_product.length - 3) + ' ' + price_product.slice(-3);

    if (img_product==''||typeof(img_product)=='undefined'||img_product=='undefined'){
        img_product = $("#img-one-"+product_id).data('src');
    }

  $("#basket__body").append('<tr id="basket_item-'+product_id+'" data-id="'+product_id+'" class="basket_item" data-price="'+price_product+'"><td width="25%"><img alt="product" class="img-responsive" src="'+location.protocol+'//'+location.hostname+'/'+img_product+'"></td><td width="50%">'+product_title+'</td><td width="20%"><span class="font-bold product-price">'+str_price_product+'</span> <span class="fa fa-ruble"></span></td><td width="5%"><a type="button" class="close" onclick="$(this).parent().parent().remove();">&times;</a></td></tr>');
});

$('#basket__body').bind("DOMSubtreeModified",function(){
    var num_item_table = $('#basket__body .basket_item').size();
    $('#basket_num_item').text('('+num_item_table+')');

    var sum = 0;
    var products = $('#basket__body .basket_item');
    for(var i=0;i<products.length;i++){
        sum += parseFloat(products.eq(i).attr('data-price'));
    }
    var str_sum = String(sum);
    $('#basket-price').html(str_sum.substring(0,str_sum.length - 3) + ' ' + str_sum.slice(-3));

    if ($('#basket__body tr').size()==1){
        $('#basket .btn').addClass('disable');
        $('#basket .modal-title').text('Корзина пуста');
        $('#basket .table-responsive').addClass('disable');
    } else {
        $('#basket .btn').removeClass('disable');
        $('#basket .modal-title').text('Корзина');
        $('#basket .table-responsive').removeClass('disable');
    }
});

$("#form button").on('click', function(event) { //устанавливаем событие отправки для формы с id=form
   event.preventDefault();

  var form_data = $(this).parent().serialize(),//$('form').serialize(),
	  basket = $('#basket__body').html(),
	  baskets = $('#basket__body').find('.basket_item'),
	  arr = [];

  for (var i=0;i<baskets.length;i++){
        arr[i] = baskets.eq(i).attr('data-id');
  }
  var form_datas = form_data+'&id='+arr.join(',');
    form_datas = decodeURIComponent(form_datas);

  $.ajax({
  type: "GET", //Метод отправки
  url: "/app/new_order", //путь до php фаила отправителя
  data: form_datas,
  success: function(data) {
    //код в этом блоке выполняется при успешной отправке сообщения
	//собираем данные о корзине для отправки в гугл аналитику
	if ($('#basket')) {
		var $arResult = new Object;
		var $items = new Array;
		$('#basket tr[id^="basket_item"]').each(function(){	
			$item = new Object();
			$item.id = $(this).attr("data-id");
			$item.price = Number($(this).attr("data-price"));
			$item.name = $(this).find('td').eq(1).html();
			$item.brand = 'Fornelli';
			$item.quantity = 1;
			$items.push($item);
		});
		
		now = new Date();
		$arResult.transaction_id = md5(now);
		$arResult.affilation = 'Fornelli shop';
		$arResult.value = 0;
		for (i = 0; i < $items.length; i++) {
			$arResult.value += $items[i]['price'];
		}
		$arResult.currency = 'RUB';
		$arResult.tax = Math.round($arResult.value / 1.2);
		$arResult.shipping = 0;
		$arResult.items = $items;
		//$jsonString = JSON.stringify($arResult);
		//console.log($jsonString);
		gtag('event', 'purchase', $arResult);
	}
    $('#basket__body .basket_item').remove();
  }
  });

});
$("#call a.call-send").on('click', function(event) { //устанавливаем событие отправки для формы с id=form
   event.preventDefault();

  var form_data = $('#phone').serialize();

  $.ajax({
    type: "POST", //Метод отправки
    url: "/app/send_call", //путь до php фаила отправителя
    data: form_data,
    success: function(data) {
           //код в этом блоке выполняется при успешной отправке сообщения
           alert(data);
    }
    });
  });
  
function getUrlVars()
{
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}

$(document).ready(function() {
    
    $(".col-sm-3").on('click', 'a[data-target="#more"]', function() {
        var id = $(this).data('number'),
            modal_wind = $(this).parents('body').find('[id="more"]');

        $.ajax({
            type:"POST",
            url: "/app/more",
            data: {id:id},
            dataType: 'html',
            success: function(response){
                $('#more').html(response);
            }
        });
    });
    
    $(".modal").on('click', 'a[data-toggle="collapse"]', function() {
        var href = $(this).data('href'),
            aria = $(this).parent('').find('[id="'+href+'"]');
        
        if (aria[0].classList.length==3){
            //aria.removeClass('in');
        }else{
            //aria.addClass('in');
        }
        
    });
    
    $(".modal").on('click', '.thumb', function() {
        var href = $(this).data('slide-to'),
            y = '',
            aria = $(this).parent('').parent('').parent('').parent('').find('[class="item active"]');
            
        for(var i=0;i<aria.length;i++){
            y = aria[i].getAttribute('data-thumb');
            if (y){
                if (y!=href){
                    aria[i].setAttribute('class','item');
                }else{
                    aria[i].setAttribute('class','item active');
                }
            }
        }
        
        aria = $(this).parent('').parent('').parent('').parent('').find('[class="item"]');
        for(var i=0;i<aria.length;i++){
            y = aria[i].getAttribute('data-thumb');
            if (y){
                if (y==href){
                    aria[i].setAttribute('class','item active');
                }
            }
        }
    });
    
    $(".col-sm-3").on('click', 'a[data-target="#buy"]', function() {
        var id = $(this).data('number'),
            modal_wind = $(this).parents('body').find('[id="buy"]');
        
        
        $.ajax({
            url: "/buy",
            data: {id:id},
            dataType: 'html',
            success: function(response){
                $('#buy').html(response);
            }
        });
    });
});


function abc2(n) {
    n += "";
    n = new Array(4 - n.length % 3).join("U") + n;
    return n.replace(/([0-9U]{3})/g, "$1 ").replace(/U/g, "");
}


